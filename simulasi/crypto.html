<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab A02: Cryptographic Failures</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0b0c10; height: 100vh; overflow: hidden; color: #c5c6c7; }
        
        /* LAYOUT */
        .lab-wrapper { display: flex; height: 100vh; }
        
        /* 1. SIDEBAR (MISSION CONTROL) */
        .sidebar { 
            width: 400px; background: #1f2833; border-right: 1px solid #45a29e; 
            display: flex; flex-direction: column; z-index: 10; 
            box-shadow: 5px 0 15px rgba(0,0,0,0.3);
        }
        .sidebar-header { padding: 20px; background: #0b0c10; border-bottom: 1px solid #45a29e; }
        .sidebar-content { flex-grow: 1; padding: 20px; overflow-y: auto; }
        
        .level-badge { 
            font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; 
            background: #0b0c10; border: 1px solid #45a29e; color: #66fcf1;
            padding: 5px 10px; border-radius: 4px; margin-bottom: 10px; display: inline-block;
        }
        .mission-card {
            background: #2b3642; border-radius: 8px; padding: 20px; margin-bottom: 20px;
            border-left: 4px solid #66fcf1; animation: fadeIn 0.5s;
        }
        
        .hint-wrapper { margin-top: auto; padding-top: 20px; border-top: 1px solid #45a29e; }
        .hint-box { 
            background: #2d3748; border: 1px solid #f6e05e; color: #fbd38d; 
            padding: 15px; border-radius: 8px; margin-top: 10px; display: none; 
            font-size: 0.9rem;
        }

        .code-snippet {
            font-family: 'JetBrains Mono', monospace; font-size: 0.8rem;
            background: #000; padding: 15px; border-radius: 6px;
            border: 1px solid #45a29e; margin-top: 10px; display: none; color: #66fcf1;
        }

        /* 2. MAIN AREA (TOOLS) */
        .main-area { 
            flex-grow: 1; padding: 30px; background: #0b0c10; 
            background-image: linear-gradient(rgba(102, 252, 241, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(102, 252, 241, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
            display: flex; flex-direction: column; gap: 20px;
        }

        /* Tool: Network Sniffer */
        .sniffer-window {
            background: #1f2833; border: 1px solid #45a29e; border-radius: 5px; 
            flex: 1; display: flex; flex-direction: column; overflow: hidden;
            box-shadow: 0 0 20px rgba(102, 252, 241, 0.1);
        }
        .window-header {
            background: #0b0c10; padding: 8px 15px; border-bottom: 1px solid #45a29e;
            color: #66fcf1; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; font-weight: bold;
            display: flex; justify-content: space-between; align-items: center;
        }
        .packet-list { list-style: none; padding: 0; margin: 0; overflow-y: auto; height: 150px; }
        .packet-item {
            padding: 8px 15px; border-bottom: 1px solid #2b3642; cursor: pointer;
            display: flex; justify-content: space-between; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem;
            color: #8892b0;
        }
        .packet-item:hover { background: #2b3642; color: #fff; }
        .packet-item.selected { background: #45a29e; color: #0b0c10; font-weight: bold; }
        
        .packet-detail {
            padding: 15px; background: #000; color: #66fcf1; font-family: 'JetBrains Mono', monospace; 
            font-size: 0.85rem; border-top: 1px solid #45a29e; flex: 1; overflow-y: auto; word-break: break-all;
        }

        /* Tool: Decoder */
        .decoder-window {
            background: #1f2833; border: 1px solid #45a29e; border-radius: 5px; 
            height: 45%; padding: 20px; display: flex; flex-direction: column;
            box-shadow: 0 0 20px rgba(102, 252, 241, 0.1);
        }
        .crypto-input {
            background: #0b0c10; border: 1px solid #45a29e; color: #66fcf1; 
            font-family: 'JetBrains Mono', monospace;
        }
        .btn-cyber {
            background: transparent; border: 1px solid #66fcf1; color: #66fcf1;
            font-family: 'JetBrains Mono', monospace; transition: all 0.3s;
        }
        .btn-cyber:hover { background: #66fcf1; color: #0b0c10; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        
        // 1. Blokir Klik Kanan (Context Menu)
        // Ini mencegah user klik kanan -> "View Page Source" atau "Inspect"
        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
        });

        // 2. Blokir Shortcut Keyboard Developer
        document.onkeydown = function(e) {
            // F12 (DevTools)
            if(e.keyCode == 123) {
                return false;
            }
            
            // Ctrl+U (View Source)
            if(e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) {
                return false;
            }
            
            // Ctrl+Shift+I (DevTools)
            if(e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) {
                return false;
            }
            
            // Ctrl+Shift+J (Console)
            if(e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) {
                return false;
            }

            // Ctrl+S (Save Page) - Mencegah download source code mudah
            if(e.ctrlKey && e.keyCode == 'S'.charCodeAt(0)) {
                return false;
            }
        };
    });
</script>
<body>

<div class="lab-wrapper">
    
    <div class="sidebar">
        <div class="sidebar-header">
            <h5 class="mb-0 fw-bold text-info"><i class="fas fa-fingerprint me-2"></i>Crypto Lab</h5>
            <small class="text-white-50">Mission: Data Interception</small>
        </div>
        
        <div class="sidebar-content">
            <div id="missionDisplay"></div>

            <div class="hint-wrapper">
                <button onclick="toggleHint()" class="btn btn-outline-info btn-sm w-100 mb-2">
                    <i class="far fa-lightbulb me-2"></i>Buka Petunjuk (Hint)
                </button>
                <div id="hintBox" class="hint-box"></div>
            </div>

            <div id="remediationSection" style="display: none;">
                <hr class="border-secondary my-4">
                <h6 class="text-info fw-bold"><i class="fas fa-shield-alt me-2"></i>Analisis & Remediasi</h6>
                <p class="small">Jangan gunakan Base64 atau MD5 untuk data sensitif.</p>
                
                <div class="d-flex gap-2 mb-2">
                    <button class="btn btn-xs btn-outline-danger w-50 active" onclick="showCode('vuln')">Vulnerable</button>
                    <button class="btn btn-xs btn-outline-success w-50" onclick="showCode('secure')">Secure</button>
                </div>
                
                <div id="codeVuln" class="code-snippet">
// ❌ RENTAN
$cc = base64_encode($input);
$pass = md5($input);
                </div>
                
                <div id="codeSecure" class="code-snippet">
// ✅ AMAN (AES-256 & Argon2)
$cc = openssl_encrypt($input, 'aes-256-gcm', $key);
$pass = password_hash($input, PASSWORD_ARGON2ID);
                </div>

                <button onclick="finishLab()" class="btn btn-info w-100 mt-4 fw-bold text-dark">Selesai & Keluar</button>
            </div>
        </div>

        <div class="p-3 border-top border-secondary text-center bg-black">
            <a href="../index.html" class="text-white-50 text-decoration-none small"><i class="fas fa-arrow-left me-1"></i> Dashboard</a>
        </div>
    </div>

    <div class="main-area">
        
        <div class="sniffer-window">
            <div class="window-header">
                <span><i class="fas fa-wifi me-2"></i>NETWORK TRAFFIC (LIVE)</span>
                <span class="badge bg-danger text-white">CAPTURING...</span>
            </div>
            <ul class="packet-list">
                <li class="packet-item" onclick="viewPacket(0)">
                    <span>GET /index.html</span> <span>200 OK</span>
                </li>
                <li class="packet-item" onclick="viewPacket(1)">
                    <span>GET /style.css</span> <span>200 OK</span>
                </li>
                <li class="packet-item" onclick="viewPacket(2, this)">
                    <span class="text-warning">POST /api/save_card</span> <span>201 Created</span>
                </li>
                <li class="packet-item" onclick="viewPacket(3)">
                    <span>GET /dashboard</span> <span>200 OK</span>
                </li>
            </ul>
            <div class="packet-detail" id="packetView">
                // Klik paket di atas untuk melihat payload...
            </div>
        </div>

        <div class="decoder-window">
            <div class="d-flex justify-content-between mb-3">
                <span class="text-info fw-bold"><i class="fas fa-terminal me-2"></i>CYBER DECODER TOOL</span>
            </div>
            
            <textarea id="toolInput" class="form-control crypto-input mb-3" rows="2" placeholder="Paste data terenkripsi di sini..."></textarea>
            
            <div class="row g-2 mb-3">
                <div class="col-8">
                    <select class="form-select bg-dark text-info border-info" id="toolMode">
                        <option value="base64">Mode: Base64 Decode</option>
                        <option value="md5">Mode: MD5 Crack (Rainbow Table)</option>
                    </select>
                </div>
                <div class="col-4">
                    <button class="btn btn-cyber w-100 fw-bold" onclick="runTool()">EXECUTE</button>
                </div>
            </div>

            <div id="toolOutput" class="p-3 border border-info rounded bg-black text-success font-monospace small flex-grow-1">
                > System Ready. Waiting for input...
            </div>
        </div>

    </div>
</div>

<script>
    // --- GAME DATA ---
    const packets = [
        "Host: bank-nusa.com\nUser-Agent: Mozilla/5.0...",
        "Content-Type: text/css\nbody { background: #fff; }",
        `POST /api/save_card HTTP/1.1
Host: bank-nusa.com
Content-Type: application/json

{
  "user": "admin",
  "cc_number": "NDU1Ni0xMTExLTIyMjItMzMzMw==",
  "cvv": "***",
  "auth_hash": "5f4dcc3b5aa765d61d8327deb882cf99"
}`,
        "Host: bank-nusa.com\nCookie: session_id=XYZ123..."
    ];
    
    // Jawaban
    const targetBase64 = "NDU1Ni0xMTExLTIyMjItMzMzMw=="; // Decodes to: 4556-1111-2222-3333
    const targetHash = "5f4dcc3b5aa765d61d8327deb882cf99"; // Cracks to: password

    // --- STATE ---
    let currentLevel = 0; // 0: Start, 1: Found Packet, 2: Decoded Base64, 3: Cracked Hash (Done)

    const missions = [
        {
            badge: "Level 1: Interception",
            title: "Penyadapan Jaringan",
            desc: "Langkah pertama: Identifikasi data yang keluar dari aplikasi.<br><br>Gunakan <strong>Network Sniffer</strong> (Panel Atas) untuk melihat lalu lintas data. Cari paket yang mengirimkan data (Metode POST).",
            hint: "Paket GET biasanya hanya mengambil halaman. Paket <strong>POST</strong> (berwarna oranye) digunakan untuk mengirim formulir. Klik paket tersebut."
        },
        {
            badge: "Level 2: Decoding",
            title: "Memecahkan Encoding",
            desc: "Bagus! Anda menemukan paket POST.<br><br>Lihat <code>cc_number</code>. String acak yang diakhiri dengan <code>==</code> adalah ciri khas <strong>Base64</strong>. Ini BUKAN enkripsi, hanya encoding.<br><br>Copy string tersebut, paste di Decoder (Panel Bawah), dan pilih mode Base64.",
            hint: "String target: <code>NDU1Ni0xMTExLTIyMjItMzMzMw==</code><br>Paste di kotak input bawah, pastikan pilihan mode adalah 'Base64 Decode'."
        },
        {
            badge: "Level 3: Cracking",
            title: "Meretas Hash Lemah",
            desc: "Kartu kredit terbaca! Sekarang lihat <code>auth_hash</code> di paket yang sama.<br><br>Itu adalah password admin yang di-hash menggunakan <strong>MD5</strong>. Karena MD5 algoritma usang, kita bisa meretasnya dengan metode 'Rainbow Table'.<br><br>Copy hash tersebut dan gunakan mode MD5 Crack.",
            hint: "Hash target: <code>5f4dcc3b5aa765d61d8327deb882cf99</code><br>Ubah mode decoder menjadi 'MD5 Crack'."
        },
        {
            badge: "Mission Complete",
            title: "Laporan Audit",
            desc: "<strong>SISTEM JEBOL!</strong><br>Anda berhasil mendapatkan Nomor Kartu Kredit (PII) dan Password Admin.<br><br>Ini membuktikan bahwa Base64 dan MD5 tidak aman untuk data finansial.",
            hint: "Misi selesai. Pelajari kode perbaikan di bawah."
        }
    ];

    // --- FUNCTIONS ---
    function renderMission() {
        const m = missions[currentLevel];
        const display = document.getElementById('missionDisplay');
        
        display.innerHTML = `
            <span class="level-badge">${m.badge}</span>
            <div class="mission-card">
                <h5 class="fw-bold mb-3 text-white">${m.title}</h5>
                <p class="small text-light opacity-75">${m.desc}</p>
            </div>
        `;
        
        // Reset Hint
        const hintBox = document.getElementById('hintBox');
        hintBox.style.display = 'none';
        hintBox.innerHTML = `<i class="fas fa-info-circle me-2"></i>${m.hint}`;
    }

    function toggleHint() {
        const box = document.getElementById('hintBox');
        box.style.display = box.style.display === 'block' ? 'none' : 'block';
    }

    function viewPacket(idx, el) {
        document.getElementById('packetView').innerText = packets[idx];
        
        // Highlight selection
        document.querySelectorAll('.packet-item').forEach(e => e.classList.remove('selected'));
        if(el) el.classList.add('selected');

        // Logic Level 1 -> 2
        if(idx === 2 && currentLevel === 0) {
            currentLevel = 1;
            renderMission();
        }
    }

    function runTool() {
        const input = document.getElementById('toolInput').value.trim();
        const mode = document.getElementById('toolMode').value;
        const output = document.getElementById('toolOutput');

        output.innerText = "> Processing...";
        output.classList.remove('text-danger');
        output.classList.add('text-success');

        setTimeout(() => {
            if (mode === 'base64') {
                try {
                    const res = atob(input);
                    if(res.includes('4556')) { // Correct CC start
                        output.innerText = `> SUCCESS: ${res}\n[!] CREDIT CARD EXPOSED`;
                        if(currentLevel === 1) {
                            currentLevel = 2;
                            renderMission();
                        }
                    } else {
                        output.innerText = `> Decoded: ${res}`;
                    }
                } catch(e) {
                    output.innerText = "> Error: Invalid Base64";
                    output.classList.add('text-danger');
                }
            } 
            else if (mode === 'md5') {
                if(input === targetHash) {
                    output.innerText = `> CRACK SUCCESS!\n> Hash: ${input}\n> Password: "password"`;
                    if(currentLevel === 2) {
                        currentLevel = 3;
                        renderMission();
                        document.getElementById('remediationSection').style.display = 'block';
                        // Scroll sidebar
                        document.querySelector('.sidebar-content').scrollTop = document.querySelector('.sidebar-content').scrollHeight;
                    }
                } else {
                    output.innerText = "> Hash not found in rainbow table.";
                    output.classList.add('text-danger');
                }
            }
        }, 500);
    }

    function showCode(type) {
        document.getElementById('codeVuln').style.display = 'none';
        document.getElementById('codeSecure').style.display = 'none';
        if(type === 'vuln') document.getElementById('codeVuln').style.display = 'block';
        else document.getElementById('codeSecure').style.display = 'block';
    }

    function finishLab() {
        localStorage.setItem('sim_a02', 'done');
        window.location.href = '../index.html';
    }

    // Init
    renderMission();
</script>

</body>
</html>
