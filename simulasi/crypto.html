<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab A02: Crypto Failures</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f4f6f8; height: 100vh; overflow: hidden; }
        
        /* --- LAYOUT UTAMA --- */
        .lab-container { display: flex; height: 100vh; }
        
        /* PANEL KIRI: PANDUAN */
        .guide-panel { 
            width: 400px; background: #0f172a; color: #fff; 
            display: flex; flex-direction: column; border-right: 1px solid #334155;
            z-index: 10; box-shadow: 4px 0 15px rgba(0,0,0,0.2);
        }
        .guide-header { padding: 20px; border-bottom: 1px solid #1e293b; background: #020617; }
        .guide-content { flex-grow: 1; padding: 20px; overflow-y: auto; }
        
        .step-card { 
            background: #1e293b; border-radius: 8px; padding: 15px; margin-bottom: 15px; 
            border-left: 4px solid #64748b; transition: all 0.3s;
        }
        .step-card.active { border-left-color: #06b6d4; background: #164e63; }
        .step-card.done { border-left-color: #22c55e; opacity: 0.6; }

        /* Code Snippet Styles */
        .code-block {
            background: #000; color: #a5b4fc; font-family: 'JetBrains Mono', monospace;
            padding: 12px; border-radius: 6px; font-size: 0.8rem; margin-top: 10px;
            border: 1px solid #334155; display: none;
        }
        .comment { color: #64748b; font-style: italic; }
        .keyword { color: #c084fc; }
        .func { color: #67e8f9; }

        /* PANEL KANAN: SIMULATOR */
        .sim-panel { 
            flex-grow: 1; padding: 30px; background: #0f172a; 
            background-image: radial-gradient(#1e293b 1px, transparent 1px);
            background-size: 20px 20px;
            display: flex; flex-direction: column; gap: 20px;
        }

        /* 1. Network Sniffer UI */
        .sniffer-window {
            background: #1e293b; border-radius: 8px; border: 1px solid #334155; overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .window-header {
            background: #334155; padding: 8px 15px; color: #e2e8f0; font-size: 0.85rem; font-weight: bold;
            display: flex; justify-content: space-between; align-items: center;
        }
        .packet-list { padding: 0; margin: 0; list-style: none; }
        .packet-item {
            padding: 10px 15px; border-bottom: 1px solid #334155; cursor: pointer;
            display: flex; justify-content: space-between; color: #94a3b8; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem;
        }
        .packet-item:hover { background: #334155; color: #fff; }
        .packet-item.selected { background: #0ea5e9; color: white; }
        
        .packet-detail {
            padding: 15px; background: #020617; color: #22c55e; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;
            border-top: 1px solid #334155; min-height: 100px; word-break: break-all;
        }

        /* 2. Decryption Tool UI */
        .tool-window {
            background: #1e293b; border-radius: 8px; border: 1px solid #334155; padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .crypto-input {
            background: #020617; border: 1px solid #475569; color: #fff; font-family: 'JetBrains Mono', monospace;
        }
        
    </style>
</head>
<body>

<div class="lab-container">
    
    <div class="guide-panel">
        <div class="guide-header">
            <h5 class="mb-0 fw-bold text-info"><i class="fas fa-key me-2"></i>Crypto Lab</h5>
            <small class="text-white-50">A02: Cryptographic Failures</small>
        </div>
        <div class="guide-content">
            
            <div class="step-card active" id="step1">
                <h6 class="fw-bold text-info">Langkah 1: Sadap Jaringan</h6>
                <p class="small mb-2">Aplikasi bank mengirim data "Credit Card" (CC) melalui jaringan. Developer mengklaim datanya sudah dienkripsi.</p>
                <p class="small">üëâ Klik paket <strong>HTTP POST</strong> di Network Sniffer (Kanan Atas) untuk melihat isinya.</p>
            </div>

            <div class="step-card" id="step2">
                <h6 class="fw-bold">Langkah 2: Analisis Pola</h6>
                <p class="small mb-2">Lihat data <code>cc_number</code>. Apakah itu enkripsi?</p>
                <div class="alert alert-dark border border-secondary p-2 small">
                    <strong>Ciri Base64:</strong><br>
                    Terdiri dari a-z, A-Z, 0-9, dan sering diakhiri tanda sama dengan (<code>=</code>).
                </div>
                <p class="small">üëâ Copy teks tersebut dan paste ke <strong>Decoder Tool</strong> (Kanan Bawah). Pilih mode "Base64 Decode".</p>
            </div>

            <div class="step-card" id="step3">
                <h6 class="fw-bold">Langkah 3: Crack Hash</h6>
                <p class="small mb-2">Kita juga menemukan database password yang bocor dalam format MD5.</p>
                <code class="d-block bg-black p-2 rounded mb-2 small text-warning">Hash: 5f4dcc3b5aa765d61d8327deb882cf99</code>
                <p class="small">üëâ Masukkan hash di atas ke Decoder Tool. Pilih mode "MD5 Crack" (Rainbow Table).</p>
            </div>

            <div id="remediationBox" style="display: none;">
                <hr class="border-secondary">
                <h6 class="fw-bold text-success"><i class="fas fa-shield-alt me-2"></i>Analisis Perbaikan</h6>
                <p class="small">Encoding (Base64) bukan Enkripsi! Hashing MD5 sudah usang.</p>
                
                <div class="d-flex gap-2 mb-2">
                    <button class="btn btn-xs btn-outline-danger w-50 active" onclick="showCode('vuln')">Vulnerable</button>
                    <button class="btn btn-xs btn-outline-success w-50" onclick="showCode('secure')">Secure</button>
                </div>

                <div id="codeVuln" class="code-block" style="display: block;">
<span class="comment">// ‚ùå SALAH: Encoding dianggap aman</span>
$cc = <span class="func">base64_encode</span>($input_cc);

<span class="comment">// ‚ùå SALAH: Hash cepat & usang</span>
$pass = <span class="func">md5</span>($password);
                </div>
                
                <div id="codeSecure" class="code-block">
<span class="comment">// ‚úÖ AMAN: Enkripsi AES-256</span>
$cc = <span class="func">openssl_encrypt</span>($input_cc, "aes-256-gcm", $key...);

<span class="comment">// ‚úÖ AMAN: Hashing Lambat (Argon2)</span>
$pass = <span class="func">password_hash</span>($pass, PASSWORD_ARGON2ID);
                </div>
                
                <button onclick="finishLab()" class="btn btn-success w-100 mt-3 fw-bold">Selesai & Keluar</button>
            </div>

        </div>
        <div class="p-3 border-top border-secondary text-center">
            <a href="../index.html" class="text-white-50 text-decoration-none small"><i class="fas fa-arrow-left me-1"></i> Kembali ke Dashboard</a>
        </div>
    </div>

    <div class="sim-panel">
        
        <div class="sniffer-window">
            <div class="window-header">
                <span><i class="fas fa-wifi me-2 text-success"></i>NETWORK TRAFFIC CAPTURE</span>
                <span class="badge bg-danger">LIVE</span>
            </div>
            <ul class="packet-list">
                <li class="packet-item" onclick="viewPacket(0)">
                    <span><span class="text-success">GET</span> /index.html</span> <span>200 OK</span>
                </li>
                <li class="packet-item" onclick="viewPacket(1)">
                    <span><span class="text-info">GET</span> /style.css</span> <span>200 OK</span>
                </li>
                <li class="packet-item" onclick="viewPacket(2, this)">
                    <span><span class="text-warning">POST</span> /api/save_card</span> <span>201 Created</span>
                </li>
                <li class="packet-item" onclick="viewPacket(3)">
                    <span><span class="text-success">GET</span> /dashboard</span> <span>200 OK</span>
                </li>
            </ul>
            <div class="packet-detail" id="packetView">
                // Klik paket di atas untuk melihat detail data...
            </div>
        </div>

        <div class="tool-window">
            <div class="window-header bg-transparent px-0 pt-0 mb-3 border-0">
                <span class="text-info fw-bold"><i class="fas fa-laptop-code me-2"></i>CYBER DECODER TOOL v2.0</span>
            </div>
            
            <label class="small text-muted mb-1">Input Data (Ciphertext / Hash):</label>
            <textarea id="toolInput" class="form-control crypto-input mb-3" rows="2" placeholder="Paste data rahasia di sini..."></textarea>
            
            <div class="row g-2 mb-3">
                <div class="col-md-8">
                    <select class="form-select bg-dark text-white border-secondary" id="toolMode">
                        <option value="base64">1. Base64 Decode (Untuk Text)</option>
                        <option value="md5">2. MD5 Crack (Untuk Password)</option>
                        <option value="aes">3. AES Decrypt (Butuh Key)</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-info w-100 fw-bold" onclick="runTool()">JALANKAN</button>
                </div>
            </div>

            <label class="small text-muted mb-1">Output Result:</label>
            <div id="toolOutput" class="p-3 border border-secondary rounded bg-black text-success font-monospace small" style="min-height: 50px;">
                Waiting for input...
            </div>
        </div>

    </div>
</div>

<script>
    // --- DATA ---
    const packets = [
        "Host: bank-nusa.com\nUser-Agent: Mozilla/5.0...",
        "Content-Type: text/css\n...",
        // TARGET DATA
        `POST /api/save_card HTTP/1.1
Host: bank-nusa.com
Content-Type: application/json

{
  "user_id": 105,
  "card_holder": "Budi Santoso",
  "cc_number": "NDU1Ni0xMTExLTIyMjItMzMzMw==", 
  "cvv": "***"
}`,
        "Host: bank-nusa.com\nCookie: session_id=..."
    ];

    const targetBase64 = "NDU1Ni0xMTExLTIyMjItMzMzMw=="; // 4556-1111-2222-3333
    const targetHash = "5f4dcc3b5aa765d61d8327deb882cf99"; // password

    // --- STATE ---
    let step1Done = false;
    let step2Done = false;
    let step3Done = false;

    // --- FUNCTIONS ---
    function viewPacket(index, el) {
        document.getElementById('packetView').innerText = packets[index];
        
        // Highlight selection
        document.querySelectorAll('.packet-item').forEach(e => e.classList.remove('selected'));
        if(el) el.classList.add('selected');

        // Check Step 1 Completion
        if(index === 2 && !step1Done) {
            step1Done = true;
            document.getElementById('step1').classList.remove('active');
            document.getElementById('step1').classList.add('done');
            document.getElementById('step2').classList.add('active');
        }
    }

    function runTool() {
        const input = document.getElementById('toolInput').value.trim();
        const mode = document.getElementById('toolMode').value;
        const output = document.getElementById('toolOutput');

        output.innerText = "Processing...";
        output.classList.remove('text-danger');
        output.classList.add('text-success');

        setTimeout(() => {
            if (mode === 'base64') {
                try {
                    const res = atob(input); // Decode Base64
                    if(res.includes('4556')) { // Check correct CC
                        output.innerHTML = `SUCCESS! DECODED DATA:\n"${res}"\n\n[!] CREDIT CARD NUMBER EXPOSED!`;
                        if(!step2Done) {
                            step2Done = true;
                            document.getElementById('step2').classList.remove('active');
                            document.getElementById('step2').classList.add('done');
                            document.getElementById('step3').classList.add('active');
                        }
                    } else {
                        output.innerText = `Decoded: "${res}"`;
                    }
                } catch(e) {
                    output.innerText = "Error: Invalid Base64 string.";
                    output.classList.add('text-danger');
                }
            } 
            else if (mode === 'md5') {
                if(input === targetHash) {
                    output.innerHTML = `HASH CRACKED!\nAlgorithm: MD5\nPassword: "password"`;
                    checkWin();
                } else {
                    output.innerText = "Hash not found in rainbow table.";
                    output.classList.add('text-danger');
                }
            } 
            else if (mode === 'aes') {
                output.innerText = "Error: Decryption Key missing. Cannot decrypt AES.";
                output.classList.add('text-danger');
            }
        }, 500);
    }

    function checkWin() {
        if(step2Done) {
            document.getElementById('step3').classList.remove('active');
            document.getElementById('step3').classList.add('done');
            
            // Show Remediation
            document.getElementById('remediationBox').style.display = 'block';
            document.querySelector('.guide-content').scrollTop = document.querySelector('.guide-content').scrollHeight;
        }
    }

    function showCode(type) {
        document.querySelectorAll('.code-block').forEach(el => el.style.display = 'none');
        if(type === 'vuln') {
            document.getElementById('codeVuln').style.display = 'block';
        } else {
            document.getElementById('codeSecure').style.display = 'block';
        }
    }

    function finishLab() {
        localStorage.setItem('sim_a02', 'done');
        window.location.href = '../index.html';
    }
</script>

</body>
</html>
